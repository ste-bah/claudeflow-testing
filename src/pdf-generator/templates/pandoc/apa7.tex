%% APA 7th Edition LaTeX Template for Pandoc
%%
%% This template produces APA 7th Edition compliant PDF output.
%% Reference: American Psychological Association. (2020). Publication manual
%% of the American Psychological Association (7th ed.).
%%
%% Usage: pandoc input.md -o output.pdf --template=apa7.tex
%%

\documentclass[$if(fontsize)$$fontsize$$else$12pt$endif$,$if(papersize)$$papersize$$else$letterpaper$endif$]{article}

%% =============================================================================
%% PACKAGES
%% =============================================================================

%% Page geometry - 1 inch margins per APA 7th Edition Section 2.22
\usepackage[$if(geometry)$$geometry$$else$margin=1in$endif$]{geometry}

%% Font packages
\usepackage{fontspec}
\usepackage{unicode-math}
\setmainfont{Times New Roman}[
  BoldFont = Times New Roman Bold,
  ItalicFont = Times New Roman Italic,
  BoldItalicFont = Times New Roman Bold Italic
]

%% Line spacing - double-spaced per APA 7th Edition Section 2.21
\usepackage{setspace}
$if(linestretch)$
\setstretch{$linestretch$}
$else$
\doublespacing
$endif$

%% Paragraph indentation - 0.5 inch per APA 7th Edition Section 2.24
\usepackage{indentfirst}
\setlength{\parindent}{0.5in}
\setlength{\parskip}{0pt}

%% Headers and footers for running head
\usepackage{fancyhdr}
\usepackage{lastpage}

%% Title formatting
\usepackage{titlesec}

%% For hanging indent in references
\usepackage{hanging}

%% URLs and hyperlinks
\usepackage{hyperref}
\hypersetup{
  colorlinks=true,
  linkcolor=black,
  citecolor=black,
  urlcolor=blue,
  pdfauthor={$for(author)$$author.name$$sep$, $endfor$},
  pdftitle={$title$}
}

%% Table and figure formatting
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{calc}
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\usepackage{multirow}

%% Fix for Pandoc table captions with "none" type
\DeclareCaptionLabelFormat{nolabel}{}
\captionsetup[table]{labelformat=nolabel}

%% Define counter for "none" caption type (Pandoc compatibility)
\newcounter{none}

%% For conditional content
\usepackage{ifthen}

%% Code highlighting (Pandoc)
\usepackage{fancyvrb}
\usepackage{xcolor}
\usepackage{framed}

%% Define Shaded environment for code blocks
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}

%% Define Highlighting environment for syntax highlighting
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}

%% Define highlighting commands
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}

%% =============================================================================
%% DOCUMENT SETTINGS
%% =============================================================================

%% Page style for running head
\pagestyle{fancy}
\fancyhf{}

%% Running head: ALL CAPS flush left, page number flush right
%% Per APA 7th Edition Section 2.18
$if(running-head)$
\fancyhead[L]{\MakeUppercase{$running-head$}}
$else$
\fancyhead[L]{\MakeUppercase{$title$}}
$endif$
\fancyhead[R]{\thepage}
\renewcommand{\headrulewidth}{0pt}

%% Plain style for first page of sections (still has running head in APA 7)
\fancypagestyle{plain}{
  \fancyhf{}
  $if(running-head)$
  \fancyhead[L]{\MakeUppercase{$running-head$}}
  $else$
  \fancyhead[L]{\MakeUppercase{$title$}}
  $endif$
  \fancyhead[R]{\thepage}
  \renewcommand{\headrulewidth}{0pt}
}

%% =============================================================================
%% HEADING STYLES - APA 7th Edition Section 2.27
%% =============================================================================

%% Level 1: Centered, Bold, Title Case
\titleformat{\section}
  {\normalfont\normalsize\bfseries\centering}
  {}
  {0pt}
  {}
\titlespacing*{\section}{0pt}{0pt}{0pt}

%% Level 2: Flush Left, Bold, Title Case
\titleformat{\subsection}
  {\normalfont\normalsize\bfseries\raggedright}
  {}
  {0pt}
  {}
\titlespacing*{\subsection}{0pt}{0pt}{0pt}

%% Level 3: Flush Left, Bold Italic, Title Case
\titleformat{\subsubsection}
  {\normalfont\normalsize\bfseries\itshape\raggedright}
  {}
  {0pt}
  {}
\titlespacing*{\subsubsection}{0pt}{0pt}{0pt}

%% Level 4: Indented, Bold, Title Case, Ending with Period.
\titleformat{\paragraph}
  {\normalfont\normalsize\bfseries}
  {}
  {0pt}
  {\hspace{\parindent}}
\titlespacing*{\paragraph}{0pt}{0pt}{0pt}

%% Level 5: Indented, Bold Italic, Title Case, Ending with Period.
\titleformat{\subparagraph}
  {\normalfont\normalsize\bfseries\itshape}
  {}
  {0pt}
  {\hspace{\parindent}}
\titlespacing*{\subparagraph}{0pt}{0pt}{0pt}

%% =============================================================================
%% CUSTOM COMMANDS
%% =============================================================================

%% Environment for hanging indent (references)
\newenvironment{hangingindent}{
  \begin{hangparas}{0.5in}{1}
}{
  \end{hangparas}
}

%% Pandoc tight list command (removes extra space in lists)
%% This is generated by Pandoc for compact lists
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

%% Abstract environment
\renewenvironment{abstract}{
  \newpage
  \section*{Abstract}
  \setlength{\parindent}{0pt}
}{
  \setlength{\parindent}{0.5in}
}

%% Keywords command
\newcommand{\keywords}[1]{
  \vspace{1em}
  \noindent\textit{Keywords}: #1
}

%% Author note environment
\newenvironment{authornote}{
  \vfill
  \noindent\textbf{Author Note}

  \noindent
}{
}

%% =============================================================================
%% TITLE PAGE - APA 7th Edition Section 2.3-2.6
%% =============================================================================

\title{
  \vspace{2in}
  \textbf{$title$}
  \vspace{0.5in}
}

\author{
  $for(author)$
  $author.name$$if(author.affiliation)$\\$author.affiliation$$endif$
  $sep$\\[1em]
  $endfor$
}

\date{}

%% =============================================================================
%% DOCUMENT CONTENT
%% =============================================================================

\begin{document}

%% Title page
\begin{titlepage}
  \thispagestyle{fancy}

  \begin{center}
    \vspace*{2in}

    %% Title - bold, centered
    {\Large\bfseries $title$}

    \vspace{1in}

    %% Authors and affiliations
    $for(author)$
    $author.name$
    $sep$,
    $endfor$

    \vspace{0.5em}

    $if(institute)$
    $for(institute)$
    $institute$
    $sep$\\
    $endfor$
    $endif$

  \end{center}

  %% Author note (for professional papers)
  $if(author-note)$
  \begin{authornote}
    $author-note$
  \end{authornote}
  $endif$
\end{titlepage}

%% Main content
$body$

\end{document}
